@page "/chat/{Id:int}"
@using Chatbot.Application.Shared
@using chatbot2.Components
@using chatbot2.Services
@implements IDisposable


<PageLayout>
    <ChildContent>
        <div id="mcon" class="messages-container">
            @foreach (var message in Messages)
            {
                <ChatMessageBox Message="message" />
            }
            @if (GeneratingResponse)
            {
                <div class="loading-indicator">
                    <LoadingIndicator />
                </div>
            }
        </div>
    </ChildContent>
    <Footer>
        <chatbot2.Components.MdInputBox Placeholder="Talk to the advisor" OnEnterClicked="OnEnterClickedHanlder" />
    </Footer>
</PageLayout>




@code {
    [Inject]
    public NavigationManager navigationManager { get; set; } = null!;
    [Inject]
    public ChatService chatService { get; set; } = null!;
    [Inject]
    public IJSRuntime JSRuntime { get; set; } = null!;
    [Parameter]
    public int Id { get; set; }

    List<ChatMessageDto> Messages = new List<ChatMessageDto>
    {
        new ChatMessageDto { Id = 1, Message = "Shall I invest in Adani power right now", IsUser = true },
        new ChatMessageDto { Id = 1, Message =@"Investment Thesis for Adani Power:

1. Strong Financials: Adani Power has shown consistent growth in its financials over the past three years. The company has a positive tangible book value, indicating a strong asset base. Additionally, the company has a high invested capital, which suggests a strong financial position.
2. Increasing Stock Price: The stock price of Adani Power has been increasing steadily over the past few days. This indicates positive investor sentiment and potential for further growth in the future.
3. Declining Revenues: Adani Power has reported declining revenues in its recent quarterly results. This could be a concern for investors as it may indicate a slowdown in the company's business operations. However, further analysis is required to determine the reasons behind the decline and its potential impact on future performance.
4. Positive News Coverage: Adani Power has been in the news recently, with multiple articles highlighting the company's performance and prospects. Positive news coverage can attract more investors and potentially drive up the stock price.
5. Power Sector Outlook: The power sector in India is expected to grow in the coming years due to increasing demand for electricity. Adani Power, being a major player in the sector, is well-positioned to benefit from this growth. However, it is important to consider the competitive landscape and regulatory environment of the sector before making an investment decision.

Conclusion:
Based on the available data, investing in Adani Power right now could be a favorable option. The company has strong financials and a positive stock price trend. However, it is important to conduct further research and analysis to fully understand the reasons behind the declining revenues and assess the potential risks associated with the power sector.", IsUser = false},
     

    };


    public bool ScrollBottomAfterRender { get; set; } = true;
    public bool GeneratingResponse { get; set; }

    protected override void OnInitialized()
    {
        this.chatService.OnChatDeleted += OnChatDeleted;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (ScrollBottomAfterRender)
        {
            await ScrollToBottom();
            ScrollBottomAfterRender = false;
        }

    }

    public void OnChatDeleted(int Id)
    {
        if (this.Id == Id)
            navigationManager.NavigateTo("");
    }

    public async Task OnEnterClickedHanlder(string Message)
    {
        var NewMessage = new ChatMessageDto
            {
                ChatId = Id,
                Message = Message,
                IsUser = true,
            };

        Messages.Add(NewMessage);
        GeneratingResponse = true;
        ScrollBottomAfterRender = true;


        var response = await this.chatService.GetBotRespose(NewMessage);
        GeneratingResponse = false;
        Messages.Add(response);

        ScrollBottomAfterRender = true;

    }

    async Task ScrollToBottom()
    {
        await JSRuntime.InvokeVoidAsync("scrollToBottom", "main-section");
    }

    public void Dispose()
    {
        this.chatService.OnChatDeleted -= OnChatDeleted;
    }
}

<style>
    .main-section {
        width: 100% !important;
    }
</style>